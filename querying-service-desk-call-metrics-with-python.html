<!DOCTYPE html>
<html lang="en">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>Querying Service Desk Call Metrics with Python</title>
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/main.css" />
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/custom.css" />
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/pygment.css" />
                                <link href="https://ignorantforager.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="HomeLab Documents Atom Feed" />
    <meta name="description" content="Extracting Metrics from Cisco Unified Call Manager (CUCM) Background About a year and a half ago, I was asked to find a way to extract metrics..." />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><center><a href="https://ignorantforager.com/">HomeLab Documents</a></center></h1>
                        <nav><ul>
                                        <li><a href="/">Home</a></li>
                                        <li><a href="/tags">Tags</a></li>
                                        <li><a href="/categories">Categories</a></li>
                                                <li><a href="https://ignorantforager.com/pages/about.html">About</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="https://ignorantforager.com/querying-service-desk-call-metrics-with-python.html" rel="bookmark"
             title="Permalink to Querying Service Desk Call Metrics with Python">Querying Service Desk Call Metrics with Python</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-02-28T00:00:00-08:00">
                Published: Fri 28 February 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="https://ignorantforager.com/author/cadence-james.html">Cadence James</a>
                </address>
        <p>In <a href="https://ignorantforager.com/category/networking.html">networking</a>.</p>
<p>tags: <a href="https://ignorantforager.com/tag/cisco.html">cisco</a> <a href="https://ignorantforager.com/tag/cucm.html">cucm</a> <a href="https://ignorantforager.com/tag/sql.html">sql</a> <a href="https://ignorantforager.com/tag/api.html">api</a> <a href="https://ignorantforager.com/tag/python.html">python</a> </p>        
</footer><!-- /.post-info -->        <h1>Extracting Metrics from Cisco Unified Call Manager (CUCM)</h1>
<h2>Background</h2>
<p>About a year and a half ago, I was asked to find a way to extract metrics from Cisco Unified Call Manager (CUCM) to support our Service Desk team. They needed basic insights:
- How many calls were made to the service desk
- Who answered the calls
- How many calls went to voicemail</p>
<p>Over time, additional requests came in, such as tracking evening-hour calls to determine if extra support was needed.</p>
<h2>Initial Challenges</h2>
<p>After some research, I found that CUCM didn’t provide an easy way to access this information through its GUI. Eventually, I discovered the Call Detail Record (CDR) page, but it had significant limitations:
- It only allowed me to export 30 days of logs manually as a CSV file.
- There was no built-in automation for data retrieval.
- Each CSV contained tens of thousands of rows of call data.</p>
<p>The challenge then became parsing through it to extract meaningful information.</p>
<h2>Key CDR Fields</h2>
<p>I won’t go into all the details of the CDR fields—it’s a massive dataset—but a few key fields for my purposes were:</p>
<ul>
<li><strong><code>dateTimeOrigination</code></strong>: The date and time when the user goes off the hook or when an H.323 SETUP message is received for an incoming call.</li>
<li><strong><code>originalCalledPartyPattern</code></strong>: The original call destination before any translations are applied.</li>
<li><strong><code>finalCalledPartyPattern</code></strong>: The final call destination before it is answered or ringing ends.</li>
<li><strong><code>destDeviceName</code></strong>: The name of the destination device.</li>
</ul>
<p>For a more comprehensive breakdown of CDR fields, I found this resource invaluable: <a href="https://www.voipdetective.com/unified-communications/reading-and-understanding-cucm-cdr-files/">Understanding CUCM CDR Files</a>. Additionally, here’s an official Cisco link with CDR codes: <a href="https://www.cisco.com/c/en/us/td/docs/voice_ip_comm/cucm/service/12_5_1/cdrdef/cucm_b_cdr-admin-guide-1251/cucm_b_cdr-admin-guide-1251_chapter_0110.html">Cisco CDR Codes</a>.</p>
<h2>Initial Solution: PowerShell Script</h2>
<p>With this information in hand, I needed a way to process it efficiently. At the time, I relied on PowerShell for automation, so I wrote a script to:
1. Parse the CDR.
2. Filter for Help Desk calls.
3. Extract the requested details.</p>
<p>After parsing the data, I would then put all of this data neatly into an excel file with PivotTables and PivotCharts. Then sent the information out to the parties requesting the information.</p>
<h3>Issues with PowerShell Approach</h3>
<p>However, the PowerShell solution had major flaws:
- <strong>Not dynamic</strong>: I had to manually list all help desk phones by device name.
- <strong>Required manual updates</strong>: Any staff changes meant manually updating the script.
- <strong>Inefficient and slow</strong>.</p>
<p>For the past year and a half, I dealt with these limitations. But this week, I decided to fix them.</p>
<h2>Improved Solution: Python Script</h2>
<p>Below is a Python script that replicates the PowerShell functionality with crucial improvements, mainly minimizing manual input.</p>
<p>I achieved this using the CUCM <strong>SOAP/AXL API</strong>. (If you're unfamiliar with it, I wrote a <a href="https://ignorantforager.com/posts/query-cucm-sql/">previous post</a> about it. While it’s not exhaustive, it’s a good starting point if you're interested.)</p>
<h3>Key Improvements</h3>
<ul>
<li><strong>Dynamic device retrieval</strong>: A custom SQL query now fetches the current list of Help Desk devices from CUCM, eliminating the need for manual updates.</li>
<li><strong>Device correlation</strong>: Each device is linked with its description and primary phone number using a non-SQL query to CUCM.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">pytz</span>

<span class="c1">#### Initialize CUCM settings</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;192.168.1.1/axl&quot;</span> <span class="c1"># Adjust URL for CUCM Publisher IP Address</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Basic &lt;BASIC AUTH HERE&gt;&#39;</span><span class="p">,</span> <span class="c1"># Replace with actual authentication</span>
    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cookie&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;COOKIE HERE&gt;&#39;</span> <span class="c1"># Replace with actual cookie if required</span>
<span class="p">}</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestsWarning</span><span class="p">)</span> <span class="c1"># Suppress SSL warnings</span>

<span class="c1"># Define XML namespace for parsing responses</span>
<span class="n">ns</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;soapenv&quot;</span><span class="p">:</span> <span class="s2">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ns&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.cisco.com/AXL/API/14.0&quot;</span>
<span class="p">}</span>

<span class="c1"># Define constants</span>
<span class="n">helpDesk</span> <span class="o">=</span> <span class="s2">&quot;5551234&quot;</span> <span class="c1"># Help desk phone number</span>
<span class="n">voicemail_server</span> <span class="o">=</span> <span class="s2">&quot;VOICEMAIL_SERVER&quot;</span> <span class="c1"># Voicemail server identifier</span>

<span class="c1">#### Read CDR (Call Detail Records) from CSV file</span>
<span class="n">cdr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;cdr.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#### Setting time zones and converting timestamps</span>
<span class="n">utc_zone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span>
<span class="n">eastern_zone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;America/New_York&#39;</span><span class="p">)</span>

<span class="c1"># Convert start time to Eastern Time</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">cdr_df</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">startTime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">utc_zone</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">eastern_zone</span><span class="p">)</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">startTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

<span class="c1"># Convert end time to Eastern Time</span>
<span class="n">endTime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">cdr_df</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">endTime</span> <span class="o">=</span> <span class="n">endTime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">utc_zone</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">eastern_zone</span><span class="p">)</span>
<span class="n">endTime</span> <span class="o">=</span> <span class="n">endTime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

<span class="c1">#### Retrieve help desk phone devices via AXL API (replace the fknumplan id with the one specific to the help desk line)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;soapenv:Envelope xmlns:soapenv=</span><span class="se">\&quot;</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="se">\&quot;</span><span class="s2"> xmlns:ns=</span><span class="se">\&quot;</span><span class="s2">http://www.cisco.com/AXL/API/14.0</span><span class="se">\&quot;</span><span class="s2">&gt;</span>
<span class="s2">        &lt;soapenv:Header /&gt;</span>
<span class="s2">        &lt;soapenv:Body&gt;</span>
<span class="s2">            &lt;ns:executeSQLQuery&gt;</span>
<span class="s2">                &lt;sql&gt;</span>
<span class="s2">                    SELECT d.name, d.description</span>
<span class="s2">                    FROM devicenumplanmap as dnpm</span>
<span class="s2">                    INNER JOIN device AS d ON dnpm.fkdevice = d.pkid</span>
<span class="s2">                    WHERE dnpm.fknumplan = &#39;c3f97eb6-aeae-280d-1aaf-9d2c47528011&#39;</span>
<span class="s2">                &lt;/sql&gt;</span>
<span class="s2">            &lt;/ns:executeSQLQuery&gt;</span>
<span class="s2">        &lt;/soapenv:Body&gt;</span>
<span class="s2">    &lt;/soapenv:Envelope&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">responseText</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">responseText</span><span class="p">)</span>

<span class="c1"># Parse device names and descriptions from XML response</span>
<span class="n">device_names</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//ns:executeSQLQueryResponse/return/row/name&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span>
<span class="n">descriptions</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//ns:executeSQLQueryResponse/return/row/description&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span>
<span class="n">phones</span> <span class="o">=</span> <span class="p">{</span><span class="n">device_name</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="n">description</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">device_names</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">)}</span>

<span class="c1">#### Sort calls into different categories</span>
<span class="n">helpDeskCalls</span> <span class="o">=</span> <span class="n">cdr_df</span><span class="p">[</span><span class="n">cdr_df</span><span class="p">[</span><span class="s1">&#39;originalCalledPartyPattern&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">helpDesk</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">helpDeskAnswered</span> <span class="o">=</span> <span class="n">helpDeskCalls</span><span class="p">[</span><span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;finalCalledPartyPattern&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">helpDesk</span><span class="p">]</span>

<span class="c1"># Identify calls that reached voicemail</span>
<span class="n">voicemailCalls</span> <span class="o">=</span> <span class="n">helpDeskCalls</span><span class="p">[</span><span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;finalCalledPartyPattern&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;8888&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">voicemailCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">voicemailCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">voicemailCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">voicemailCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">eastern_zone</span><span class="p">)</span>

<span class="c1"># Convert call timestamps</span>
<span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeOrigination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">eastern_zone</span><span class="p">)</span>

<span class="c1"># Identify calls made between 5 PM and 8 PM</span>
<span class="n">eveningCalls</span> <span class="o">=</span> <span class="n">helpDeskCalls</span><span class="p">[</span>
    <span class="p">(</span><span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1">#### Count calls per device</span>
<span class="n">calling_numbers</span> <span class="o">=</span> <span class="n">helpDeskCalls</span><span class="p">[</span><span class="s1">&#39;destDeviceName&#39;</span><span class="p">]</span>
<span class="n">call_counts</span> <span class="o">=</span> <span class="n">calling_numbers</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">call_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">,</span> <span class="s1">&#39;CallCount&#39;</span><span class="p">]</span>
<span class="n">call_counts</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_counts</span><span class="p">[</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">phones</span><span class="p">)</span>
<span class="n">call_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">call_counts</span><span class="p">[</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">voicemail_server</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Voicemail&quot;</span>
<span class="n">call_counts</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_counts</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>

<span class="c1">#### Retrieve phone numbers for devices using AXL API</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">call_counts</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">device</span> <span class="o">==</span> <span class="n">voicemail_server</span><span class="p">:</span>
        <span class="n">call_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;PhoneNumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;8888&quot;</span>
        <span class="k">continue</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;soapenv:Envelope xmlns:soapenv=</span><span class="se">\&quot;</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="se">\&quot;</span><span class="s2"> xmlns:ns=</span><span class="se">\&quot;</span><span class="s2">http://www.cisco.com/AXL/API/14.0</span><span class="se">\&quot;</span><span class="s2">&gt;</span>
<span class="s2">            &lt;soapenv:Header /&gt;</span>
<span class="s2">            &lt;soapenv:Body&gt;</span>
<span class="s2">                &lt;ns:getPhone&gt;</span>
<span class="s2">                    &lt;name&gt;</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&lt;/name&gt;</span>
<span class="s2">                &lt;/ns:getPhone&gt;</span>
<span class="s2">            &lt;/soapenv:Body&gt;</span>
<span class="s2">        &lt;/soapenv:Envelope&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">responseText</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">responseText</span><span class="p">)</span>
    <span class="n">phone_numbers</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//ns:getPhoneResponse/return/phone/lines/line/dirn/pattern&quot;</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">phone_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">phone_numbers</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
    <span class="n">call_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;PhoneNumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phone_number</span>

<span class="c1"># Organize call counts data</span>
<span class="n">call_counts</span> <span class="o">=</span> <span class="n">call_counts</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PhoneNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;DeviceName&#39;</span><span class="p">,</span> <span class="s1">&#39;CallCount&#39;</span><span class="p">])</span>
<span class="n">call_counts</span> <span class="o">=</span> <span class="n">call_counts</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;PhoneNumber&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#### Output evening and voicemail calls to text files</span>
<span class="n">evening_calls_text</span> <span class="o">=</span> <span class="n">eveningCalls</span><span class="p">[[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;evening_calls.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">evening_calls_text</span><span class="p">)</span>

<span class="n">voicemail_calls_text</span> <span class="o">=</span> <span class="n">voicemailCalls</span><span class="p">[[</span><span class="s1">&#39;dateTimeEastern&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;voicemail_calls.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">voicemail_calls_text</span><span class="p">)</span>

<span class="c1">#### Print summary information</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Time: </span><span class="si">{</span><span class="n">startTime</span><span class="si">}</span><span class="s2"> ET&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End Time: </span><span class="si">{</span><span class="n">endTime</span><span class="si">}</span><span class="s2"> ET&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Calls: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cdr_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Help Desk Calls: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">helpDeskCalls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Help Desk Voicemails: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">voicemailCalls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total 5-8 Calls made: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">eveningCalls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">call_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2>Remaining Challenges</h2>
<p>This solution is about <strong>75% automated</strong> (98.7% of all stats are made up, this one included). The biggest remaining manual task is <strong>downloading the CSV file</strong>. Additionally, I still <strong>import the data into Excel</strong> for visualization. Though I know Python has libraries for this, I lack the access to Python’s visualization tools, which is an unfortunate limitation for now.</p>
<h2>Conclusion</h2>
<p>Overall, this approach is a significant improvement over my previous workflow, making Service Desk call metrics tracking much more efficient.</p>
      </div><!-- /.entry-content -->

    </article>
  </section>

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->
                </footer><!-- /#contentinfo -->

        </body>
</html>