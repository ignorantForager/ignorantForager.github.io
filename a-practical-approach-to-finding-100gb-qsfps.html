<!DOCTYPE html>
<html lang="en">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>A Practical Approach to Finding 100GB QSFPs</title>
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/main.css" />
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/custom.css" />
                        <link rel="stylesheet" href="https://ignorantforager.com/theme/css/pygment.css" />
                                <link href="https://ignorantforager.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="HomeLab Documents Atom Feed" />
    <meta name="description" content="Automating 100GB QSFP Transceiver Inventory with PowerShell Understanding the quantity and distribution of 100GB QSFP transceivers in your data..." />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><center><a href="https://ignorantforager.com/">HomeLab Documents</a></center></h1>
                        <nav><ul>
                                        <li><a href="/">Home</a></li>
                                        <li><a href="/tags">Tags</a></li>
                                        <li><a href="/categories">Categories</a></li>
                                                <li><a href="https://ignorantforager.com/pages/about.html">About</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="https://ignorantforager.com/a-practical-approach-to-finding-100gb-qsfps.html" rel="bookmark"
             title="Permalink to A Practical Approach to Finding 100GB QSFPs">A Practical Approach to Finding 100GB QSFPs</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-05-02T00:00:00-07:00">
                Published: Thu 02 May 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="https://ignorantforager.com/author/cadence-james.html">Cadence James</a>
                </address>
        <p>In <a href="https://ignorantforager.com/category/networking.html">networking</a>.</p>
<p>tags: <a href="https://ignorantforager.com/tag/cisco.html">cisco</a> <a href="https://ignorantforager.com/tag/powershell.html">powershell</a> <a href="https://ignorantforager.com/tag/plink.html">plink</a> <a href="https://ignorantforager.com/tag/qsfp.html">qsfp</a> </p>        
</footer><!-- /.post-info -->        <h2>Automating 100GB QSFP Transceiver Inventory with PowerShell</h2>
<p>Understanding the quantity and distribution of 100GB QSFP transceivers in your data center can be essential for optimizing network performance. But how can you efficiently gather this information across multiple devices? Let me share with you a straightforward method I’ve developed using PowerShell, which you can adapt to suit your environment.</p>
<p>Firstly, I typically start by SSH’ing into my devices to manually gather information. This initial exploration helps me identify patterns that can be automated later. One command I’ve found to be particularly useful is <code>show interface transceiver</code>, which lists all SFP transceivers used on the device. By filtering for lines containing <code>40/100</code>, I can quickly identify 100GB QSFPs.</p>
<h3>PowerShell Script for Automating the Process</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Prompt the user to enter a username and password</span>
<span class="nv">$username</span> <span class="p">=</span> <span class="nb">Read-Host</span> <span class="n">-Prompt</span> <span class="s2">&quot;Username&quot;</span>
<span class="nv">$password</span> <span class="p">=</span> <span class="nb">Read-Host</span> <span class="n">-Prompt</span> <span class="s2">&quot;Password&quot;</span> <span class="n">-AsSecureString</span>

<span class="c"># Convert the SecureString password into a plain text string (security risk!)</span>
<span class="nv">$temppass</span> <span class="p">=</span> <span class="no">[System.Runtime.InteropServices.Marshal]</span><span class="p">::</span><span class="n">SecureStringToCoTaskMemUnicode</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span>
<span class="nv">$password</span> <span class="p">=</span> <span class="no">[System.Runtime.InteropServices.Marshal]</span><span class="p">::</span><span class="n">PtrToStringUni</span><span class="p">(</span><span class="nv">$temppass</span><span class="p">)</span>

<span class="c"># Import device list from a CSV file (expects a file named &#39;devices.csv&#39; in the same directory)</span>
<span class="nv">$devices</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="s2">&quot;.\devices.csv&quot;</span>

<span class="c"># Initialize counters and a variable to store transceiver count</span>
<span class="nv">$totalcount</span> <span class="p">=</span> <span class="n">0</span>
<span class="nv">$count</span> <span class="p">=</span> <span class="n">1</span>
<span class="nv">$t</span> <span class="p">=</span> <span class="nv">$null</span>

<span class="c"># Loop through each device listed in the CSV file</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$device</span> <span class="k">in</span> <span class="nv">$devices</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Clear </span> <span class="c"># Clears the screen for a cleaner output</span>

    <span class="c"># Display progress information</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot; ------------------------&quot;</span> <span class="n">-foreground</span> <span class="n">Cyan</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot; Querying device: $count of </span><span class="p">$(</span><span class="nv">$devices</span><span class="p">.</span><span class="n">count</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-foreground</span> <span class="n">Cyan</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot; ------------------------&quot;</span> <span class="n">-foreground</span> <span class="n">Cyan</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>

    <span class="c"># Test connectivity to the device using its IP address (returns $True if reachable)</span>
    <span class="nv">$testconnection</span> <span class="p">=</span> <span class="nb">Test-Connection</span> <span class="p">$(</span><span class="nv">$device</span><span class="p">.</span><span class="n">ipaddress</span><span class="p">)</span> <span class="n">-Count</span> <span class="n">1</span> <span class="n">-Quiet</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$testconnection</span> <span class="o">-eq</span> <span class="nv">$True</span><span class="p">)</span> <span class="p">{</span>
        <span class="c"># Attempt an SSH connection using Plink (first echo y to accept new SSH host keys)</span>
        <span class="nb">echo </span><span class="n">y</span> <span class="p">|</span> <span class="n">plink</span> <span class="p">$(</span><span class="nv">$device</span><span class="p">.</span><span class="n">ipaddress</span><span class="p">)</span> <span class="n">-ssh</span>

        <span class="c"># Execute a command remotely to check for 40/100Gb transceivers</span>
        <span class="nv">$t</span> <span class="p">=</span> <span class="p">$(</span><span class="n">plink</span> <span class="p">$(</span><span class="nv">$device</span><span class="p">.</span><span class="n">ipaddress</span><span class="p">)</span> <span class="n">-l</span> <span class="nv">$username</span> <span class="n">-pw</span> <span class="nv">$password</span> <span class="n">-batch</span> <span class="s2">&quot;show interface transceiver | include 40/100&quot;</span><span class="p">)</span>

        <span class="c"># Add the count of detected transceivers to the total</span>
        <span class="nv">$totalcount</span> <span class="p">=</span> <span class="nv">$totalcount</span> <span class="p">+</span> <span class="nv">$t</span><span class="p">.</span><span class="n">count</span>
    <span class="p">}</span>

    <span class="c"># Increment the counter for device tracking</span>
    <span class="nv">$count</span><span class="p">++</span>
<span class="p">}</span>

<span class="c"># Display the total count of detected QSFP transceivers</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot; Total 100GB QSFP Transceivers: $totalcount&quot;</span>
</code></pre></div>

<h3>Key Considerations</h3>
<ol>
<li>
<p><strong>Password Handling:</strong></p>
<ul>
<li>This script converts the secure string into a regular string due to Plink’s inability to handle secure strings correctly.</li>
<li>While it prevents shoulder surfing during password entry, handling passwords as plain text, even temporarily, poses security risks.</li>
<li>Consider using SSH keys or credential vaults for improved security.</li>
</ul>
</li>
<li>
<p><strong>Device Input:</strong></p>
<ul>
<li>The script imports device information from a CSV file.</li>
<li>You can adapt it to read from a text file if that better suits your setup.</li>
</ul>
</li>
<li>
<p><strong>Manual Progress Display:</strong></p>
<ul>
<li>Instead of PowerShell’s built-in progress bar module, a manual display is used.</li>
<li>The built-in progress bar tends to drift off-screen after iterating through many devices.</li>
</ul>
</li>
<li>
<p><strong>Plink Usage:</strong></p>
<ul>
<li>Plink, the PuTTY CLI interface, is used for SSH access to Cisco devices.</li>
<li>It provides a convenient way to query information across multiple devices.</li>
</ul>
</li>
</ol>
<p>Feel free to tailor this script to your needs and environment. With automation, you can streamline the process of gathering network inventory data, enabling better decision-making and optimization of your data center infrastructure.</p>
      </div><!-- /.entry-content -->

    </article>
  </section>

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->
                </footer><!-- /#contentinfo -->

        </body>
</html>